<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>aaa</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/custom-style.css}">
</head>
<body>
<div hidden>
    <input type="hidden" id="courseId" th:value="${course.id}">
    <!--<input type="hidden" id="csrf_name" th:value="${_csrf.parameterName}">
    <input type="hidden" id="csrf_token" th:value="${_csrf.token}">-->
</div>
<header th:replace="course/layout:: courseHeader"></header>
<div>
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <ul class="breadcrumb">
                    <li>
                        <a th:href="@{/course/}"><a th:href="@{/course/}">课程</a></a>
                    </li>
                    <li>
                        <a href="#"><span th:text="${course.classification.direction.name}"></span></a>
                    </li>
                    <li>
                        <a href="#"><span th:text="${course.classification.name}"></span></a>
                    </li>
                    <li class="active">
                        <span th:text="${course.name}"></span>
                    </li>
                </ul>
                <div class="row clearfix">
                    <div class="col-md-8 column">
                        <div class="page-header">
                            <h1>
                                <span th:text="${course.name}"></span>
                                <small>
                                    <span id="collection_span" hidden class="glyphicon glyphicon-star"
                                          style="color: red;"></span>
                                    <span id="collection_cancel_span" hidden class="glyphicon glyphicon-star-empty"
                                          style="color: #444444;"></span>
                                </small>
                            </h1>
                            <div class="emooc-teacher-info">
                                <img th:src="${course.teacher.avatar}" alt="教师头像">
                                <span style="font-size: 18px;" th:text="${course.teacher.username}"></span>
                                <div style="display: inline;padding-left: 30px">
                                    <span>难度:</span><span th:text="${course.grade.description}"></span>
                                    <span>学习人数:</span><span>1000</span>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <ul class="nav nav-pills nav-justified">
                                <li role="presentation" class="active"><a href="#tabSection" data-toggle="tab">课程章节</a>
                                </li>
                                <li role="presentation"><a href="#tabQuestion" data-toggle="tab">问答</a></li>
                                <li role="presentation"><a href="#tabNotes" data-toggle="tab">笔记</a></li>
                                <li role="presentation"><a href="#tabComment" data-toggle="tab">评价</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="tabSection">
                                    <div class="emooc-course-description emooc-course-wrap"
                                         th:text="${'简介:'+course.intro}">
                                    </div>
                                    <div class="emooc-course-chapters">
                                        <div class="emooc-chapter emooc-course-wrap emooc-chapter-active"
                                             th:each="section:${course.sections}">
                                            <!-- 章节标题 -->
                                            <h3 th:text="${section.name}"></h3>
                                            <div class="chapter-description" th:text="${section.detail}">
                                                本章讲为你介绍这门课具体讲什么，内容如何安排，学习心得等，让你对课程有一个整体的认识。
                                            </div>
                                            <!-- 章节标题 end -->
                                            <!-- 章节小节 -->
                                            <ul class="video" th:each="video:${section.videos}">
                                                <li data-media-id="17139">
                                                    <a th:href="${video.path}" class="J-media-item">
                                                        <span class="glyphicon glyphicon-play"></span>
                                                        <span th:text="${video.name}"></span>(<span
                                                            th:text="${video.duration}"></span>)
                                                        <button class="r moco-btn moco-btn-red preview-btn">开始学习
                                                        </button>
                                                    </a>
                                                </li>
                                            </ul>
                                            <!-- 章节小节 end -->
                                        </div>
                                        <div class="emooc-course-description emooc-course-wrap">
                                            <span>没有啦</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="tabQuestion">
                                    <div id="questionEditor"></div>
                                    <button id="btn_question">提交</button>
                                    <ul>
                                        <li th:each="question:${course.questions}">
                                            <div class="emooc-course-wrap"><span th:text="${question.detail}" Z></span>
                                            </div>
                                        </li>
                                    </ul>

                                </div>
                                <div class="tab-pane fade" id="tabNotes">
                                    tab Notes
                                </div>
                                <div class="tab-pane fade" id="tabComment">
                                    tab Comment
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-4 column">
                        <div class="emooc-course-wrap emooc-course-aside-info js-usercard-box">
                            <div class="learn-btn">
                                <a th:if="${course.sections} ne null and !${course.sections.isEmpty()}"
                                   th:href="${course.sections.get(0).videos.get(0).path}"
                                   class="emooc-moco-btn emooc-moco-btn-red emooc-moco-btn-lg J-learn-course">开始学习</a>
                                <button th:if="${course.sections} eq null or ${course.sections.isEmpty()}"
                                        class="emooc-moco-btn emooc-moco-btn-red emooc-moco-btn-lg J-learn-course">
                                    老师还没有添加课程
                                </button>
                            </div>
                            <div class="emooc-course-info-tip">
                                <dl class="first">
                                    <dt>课程须知</dt>
                                    <dd class="autowrap" th:text="${course.notice}">
                                    </dd>
                                </dl>
                                <dl>
                                    <dt>老师告诉你能学到什么？</dt>
                                    <dd class="autowrap" th:text="${course.wtcanlearn}"></dd>
                                </dl>
                            </div>
                        </div>

                        <div class="js-commend-box">
                            <div class="mb40 recom-course-list-box"><h4>推荐课程</h4>
                                <ul class="js-recom-course recom-course-list clearfix">
                                    <li class="clearfix" th:each="recomend:${recommends}">
                                        <a th:href="${'/course/learn/'+recomend.id}" class="clearfix" target="_blank">
                                            <div class="l content-box">
                                                <div style="display: inline-block;">
                                                    <img th:src="${recomend.imagePath}"
                                                         style="width: 56px; height: 56px;" alt="">
                                                </div>
                                                <div style="display: inline-block">
                                                    <p class="smalle-title" th:text="${recomend.name}"
                                                       style="display: inline-block; margin-bottom: 0; margin-top: 5px">
                                                        系统学习Docker践行DevOps理念
                                                    </p>
                                                    <div class="clearfix learn-detail">
                                                        实战<span>·</span>
                                                        <span th:text="${recomend.grade.description}"></span>
                                                        <span>·</span><i class="glyphicon glyphicon-user"
                                                                         style="color: #8c989f"></i>
                                                        <span th:text="${recomend.studies.size()}"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/wangeditor@3.1.1/release/wangEditor.min.js"></script>
<script>
    $(document).ready(function () {
        let E = window.wangEditor;
        let questionEditor = new E('#questionEditor');
        questionEditor.create();

        let star = $("#collection_span");
        let empty_star = $("#collection_cancel_span");
        let course_id = $("#courseId");
        let csrf_token = $("#csrf_token");
        let btnQuestion = $("#btn_question");

        $.get({
            url: '/user/rest/isCollection/' + course_id,
            success: function (response) {
                if (response.code) {
                    star.show();
                    empty_star.hide()
                } else {
                    empty_star.show();
                    star.hide();
                }
            }
        });
        star.click(function () {
            $.get({
                url: '/user/rest/collection/cancel/' + course_id,
                success: function (response) {
                    if (response.code) {
                        empty_star.show();
                        star.hide();
                        alert(response.message)
                    }
                }
            })
        });
        empty_star.click(function () {
            $.get({
                url: '/user/rest/collection/course/' + course_id,
                success: function (response) {
                    console.log(response);
                    if (response.code) {
                        empty_star.hide();
                        star.show();
                        alert(response.message)
                    }
                }
            })
        });
        btnQuestion.click(function () {
            $.ajax({
                url: '/course/learn/rest/question',
                type: 'post',
                data: {
                    "[[${_csrf.parameterName}]]": "[[${_csrf.token}]]",
                    courseId: course_id.val(),
                    question: questionEditor.txt.html(),
                },
                dataType: "json",
                /*contentType: "application/json",*/
                success: function (response) {
                    console.log(response);
                }
            })

        })
    })
    /*JSON.stringify({
                    courseId: course_id.val(),
                    question: questionEditor.txt.html(),
                    "[[${_csrf.parameterName}]]": "[[${_csrf.token}]]"
                }),*/

</script>
</html>